<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartBag Configuration</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/configure.css">
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="circle circle-1"></div>
        <div class="circle circle-2"></div>
        <div class="circle circle-3"></div>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-transparent">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-shopping-bag"></i> SmartBag Configuration
            </a>
            <div class="navbar-nav ml-auto">
                <div class="nav-item">
                    <span class="navbar-text device-status" id="deviceStatus">
                        <i class="fas fa-circle status-disconnected"></i> 
                        <span id="deviceName">Not Connected</span>
                    </span>
                </div>
                <a href="/" class="btn btn-outline-light btn-sm ml-2">
                    <i class="fas fa-home"></i> Home
                </a>
                <button id="logoutBtn" class="btn btn-outline-light btn-sm ml-2">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Device Connection Status -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="config-card">
                    <div class="card-body text-center">
                        <h5><i class="fas fa-wifi"></i> Device Connection</h5>
                        <div id="connectionIndicator" class="connection-indicator">
                            <div class="connection-status" id="connectionStatus">
                                <i class="fas fa-circle status-disconnected"></i>
                                <span>Connecting to device...</span>
                            </div>
                            <small class="text-muted" id="connectionDetails">Establishing Socket.IO connection</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Steps -->
        <div class="row">
            <div class="col-12">
                <!-- Step 1: QR Code Upload -->
                <div class="config-card mb-4">
                    <div class="card-header">
                        <h4><i class="fas fa-qrcode"></i> Step 1: Upload QR Codes</h4>
                        <p class="text-muted mb-0">Upload QR codes generated for your SmartBag items</p>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="form-group">
                                    <label for="qrFiles">
                                        <i class="fas fa-upload"></i> Select QR Code Images
                                    </label>
                                    <input type="file" 
                                           class="form-control-file" 
                                           id="qrFiles" 
                                           accept="image/*"
                                           multiple
                                           required>
                                    <small class="form-text text-muted">
                                        Select multiple QR code image files (PNG, JPG, GIF)
                                    </small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <button id="uploadQRBtn" class="btn btn-primary btn-block" disabled>
                                    <i class="fas fa-cloud-upload-alt"></i> Upload QR Codes
                                </button>
                            </div>
                        </div>
                        
                        <!-- Upload Progress -->
                        <div id="uploadProgress" class="upload-progress" style="display: none;">
                            <div class="progress mb-2">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" 
                                     id="progressBar"
                                     style="width: 0%">0%</div>
                            </div>
                            <small class="text-muted" id="progressText">Preparing upload...</small>
                        </div>

                        <!-- Upload Status -->
                        <div id="uploadStatus" class="mt-3"></div>
                    </div>
                </div>

                <!-- Step 2: QR Code Gallery -->
                <div class="config-card mb-4" id="qrGalleryCard" style="display: none;">
                    <div class="card-header">
                        <h4><i class="fas fa-images"></i> Step 2: Your QR Codes</h4>
                        <p class="text-muted mb-0">Click "Take Photo" next to each QR code to capture the corresponding item</p>
                    </div>
                    <div class="card-body">
                        <div id="qrGallery" class="qr-gallery">
                            <!-- QR codes will be displayed here -->
                        </div>
                    </div>
                </div>

                <!-- Step 3: Camera Interface -->
                <div class="config-card mb-4" id="cameraCard" style="display: none;">
                    <div class="card-header">
                        <h4><i class="fas fa-camera"></i> Step 3: Capture Item Photo</h4>
                        <p class="text-muted mb-0" id="capturePrompt">Taking photo for: <strong id="currentItem"></strong></p>
                    </div>
                    <div class="card-body">
                        <div class="camera-container">
                            <div class="camera-view">
                                <video id="cameraVideo" autoplay playsinline></video>
                                <canvas id="cameraCanvas" style="display: none;"></canvas>
                            </div>
                            <div class="camera-controls">
                                <button id="startCameraBtn" class="btn btn-info">
                                    <i class="fas fa-video"></i> Start Camera
                                </button>
                                <button id="captureBtn" class="btn btn-success" style="display: none;">
                                    <i class="fas fa-camera"></i> Capture Photo
                                </button>
                                <button id="retakeBtn" class="btn btn-warning" style="display: none;">
                                    <i class="fas fa-redo"></i> Retake
                                </button>
                                <button id="savePhotoBtn" class="btn btn-primary" style="display: none;">
                                    <i class="fas fa-save"></i> Save Photo
                                </button>
                                <button id="closeCameraBtn" class="btn btn-secondary">
                                    <i class="fas fa-times"></i> Close Camera
                                </button>
                            </div>
                        </div>
                        
                        <!-- Photo Preview -->
                        <div id="photoPreview" class="photo-preview" style="display: none;">
                            <img id="previewImage" src="" alt="Captured photo">
                            <div class="preview-info">
                                <p id="photoInfo"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Download Section -->
                <div class="config-card" id="downloadCard" style="display: none;">
                    <div class="card-header">
                        <h4><i class="fas fa-download"></i> Step 4: Download Configuration</h4>
                        <p class="text-muted mb-0">Download your QR codes and item images as a ZIP file</p>
                    </div>
                    <div class="card-body text-center">
                        <div class="download-info mb-3">
                            <h5 id="completionStatus">Configuration Progress</h5>
                            <div class="progress mb-2">
                                <div class="progress-bar bg-success" 
                                     role="progressbar" 
                                     id="completionProgress"
                                     style="width: 0%">0%</div>
                            </div>
                            <small class="text-muted" id="completionText">0 of 0 items configured</small>
                        </div>
                        
                        <button id="downloadZipBtn" class="btn btn-success btn-lg" disabled>
                            <i class="fas fa-file-archive"></i> Download Configuration ZIP
                        </button>
                        
                        <div class="mt-3">
                            <small class="text-muted">
                                The ZIP file will contain all QR codes and corresponding item photos
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/configure.js"></script>
</body>
</html>